jQuery ->
    loadEventHandlers()

loadEventHandlers = ->
    historyHandler()
    handleNavLinkClose()
    sidemenuCourseHandler()

scheduleNameUpdater = ->
    $(".scheduleNameUpdate").live("click", (e)->
        $("#scheduleName").html($(this).html())
    )

historyHandler = ->
    if history && history.pushState
        jQuery ->
            $(".updateHistory a").live("click", (e)->
                history.pushState(null, "", this.href)
                ###
                e.preventDefault()
                ###
            )
            $(window).bind('popstate', ->
                $.getScript(location.href)
            )

handleNavLinkClose = ->
    $(".navLinkClose").live('click', (e)->
        urlStrs = [
            "<%= j(Rails.root) %>"
            "active_schedulator_relationships"
            $(this).data("active-rel") 
        ]
        $.ajax({
            url: urlStrs.join("/"),
            type:"delete"
        })
    )

sidemenuCourseHandler = ->
    $(".sidemenu-course").live('click', (e)->
        courseDiv = $(this)
        if courseDiv.children(".course-header").hasClass("bg-dark-green")
            courseDiv.children(".course-header").removeClass("bg-dark-green")
            courseDiv.children(".sidemenu-sections").hide('slow')
        else
            courseDiv.children(".course-header").addClass("bg-dark-green")
            courseDiv.children(".sidemenu-sections").show('slow')
    )